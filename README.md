# mysql-crud
基于 mysql2 二次封装的增删改查。以高阶函数的方式进行提取，并提供了 获取器 设置器 等...

## book表
```sql
mysql> SELECT * FROM az_book;
+----+----------------+-------------------------------------------------+----------------------+---------------------+-------------+
| id | title          | des                                             | author               | create_date         | delete_date |
+----+----------------+-------------------------------------------------+----------------------+---------------------+-------------+
|  1 | 房思琪的初恋乐园  | 令人心碎却无能为力的真实故事。                       | 林奕含                | 2021-10-27 16:01:21  | NULL        |
|  2 | 白夜行          | 东野圭吾万千书迷心中的无冕之王                       | 东野圭吾              | 2021-10-27 16:01:33  | NULL        |
|  3 | 追风筝的人       | 12岁的阿富汗富家少爷阿米尔与仆人哈桑情同手足。然而...   | 卡勒德·胡赛尼          | 2021-10-27 16:02:00  | NULL        |
+----+----------------+-------------------------------------------------+----------------------+---------------------+-------------+
3 rows in set (0.00 sec)
```

## image表
```sql
mysql> SELECT * FROM az_image;
+----+--------------------------------------------------------------+-------+--------+---------------------+------+
| id | path                                                         | width | height | create_date         | from |
+----+--------------------------------------------------------------+-------+--------+---------------------+------+
|  1 | view/subject/s/public/s29651121.jpg                          |   135 |    195 | 2021-10-27 15:57:11 | 1    |
|  2 | view/subject/s/public/s24514468.jpg                          |   135 |    195 | 2021-10-27 15:57:13 | 1    |
|  3 | https://img3.doubanio.com/view/subject/s/public/s1727290.jpg |   135 |    195 | 2021-10-27 15:57:15 | 0    |
+----+--------------------------------------------------------------+-------+--------+---------------------+------+
3 rows in set (0.00 sec)
```

### 链接数据库
```javascript
const {initDb} = require('mysql-crud')

/**
 * initDb 初始化数据库，这时候不会去进行数据库链接。
 * 只有进行表操作的时候才会进行数据库链接
 */
const db = initDb({
    // 数据库地址
    host: 'localhost',
    // 数据库用户名
    user: 'root',
    // 数据库密码
    password: '',
    // 端口，可缺省默认 3306
    port: 3306,
    // 数据库名
    database: 'az_dbtest',
    // 表前缀
    table_prefix: 'az_',
    // 连接池数量, 可缺省
    connectionLimit: 16,
    // 队列数， 可缺省
    queueLimit: 0
})
```

### 查询
```javascript
/**
 * spotTable方法 会从初始化好的数据库中定位到指定表。并不会发生sql操作
 * @param {string} tableName 表名，如果初始化数据库传入了表前缀会加上表前缀。 book => az_book
 * @param {object} prop      可缺省的表辅助操作对象
 */
const {spotTable, R} = db
const tableBook = spotTable('book', { // 第二个参数是可以缺省的
    field: ['*'], // 对查询语句的字段嗮选， 可缺省
    order: ['id DESC'], // 查询结果根据id进行倒序， 可缺省
})

/**
 * R方法 根据spotTable去进行查询，通过返回数组的两个句柄函数。实现查询单条或者多条
 */
const [findBook, filterBook] = R(tableBook)

```
> findBook即单条查询，为空返回null，不为空返回一个对象
```javascript

findBook({id: 1}).then(console.log) 
/*
生成的Sql语句 => SELECT * FROM az_book WHERE `id` = 1 ORDER BY id DESC LIMIT 1
结果：{
  id: 1,
  title: '房思琪的初恋乐园',
  des: '令人心碎却无能为力的真实故事。',
  author: '林奕含',
  create_date: 2021-10-27T08:01:21.000Z,
  delete_date: null
}
*/
```
